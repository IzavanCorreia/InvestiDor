<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <h:head>
        <title>Perfil</title>
        <style>
            .profile-container {
                margin: 20px;
            }

            .profile-grid {
                display: grid;
                grid-template-columns: 100px auto;
                grid-gap: 10px;
            }

            .profile-grid label {
                font-weight: bold;
            }

            .edit-profile-btn {
                margin-top: 20px;
            }
        </style>
    </h:head>

    <h:body>

        <ui:include src="MenuUsuario.xhtml"/>

        <div class="profile-container">
            <h2>Perfil: #{loginController.usuarioLogado.nome} #{loginController.usuarioLogado.sobrenome}</h2>

            <h:form>
                <div class="profile-grid">
                    <h:outputLabel for="cpf" value="CPF:"/>
                    <h:outputText id="cpf" value="#{loginController.usuarioLogado.cpf}"/>

                    <h:outputLabel for="nome" value="Nome:"/>
                    <h:outputText id="nome" value="#{loginController.usuarioLogado.nome}"/>

                    <h:outputLabel for="sobrenome" value="Sobrenome:"/>
                    <h:outputText id="sobrenome" value="#{loginController.usuarioLogado.sobrenome}"/>

                    <h:outputLabel for="telefone" value="Telefone:"/>
                    <h:outputText id="telefone" value="#{loginController.usuarioLogado.telefone}"/>

                    <h:outputLabel for="email" value="E-mail:"/>
                    <h:outputText id="email" value="#{loginController.usuarioLogado.email}"/>
                </div>

                <p:commandButton value="Criar metas" styleClass="edit-profile-btn"
                                 update=":formMetas" oncomplete="PF('criarMetasDialog').show()"/>

                <p:commandButton value="Editar perfil" styleClass="edit-profile-btn"
                                 update=":formAlt" oncomplete="PF('editarPerfilDialog').show()"/>

                <p:commandButton value="Trocar senha" styleClass="edit-profile-btn"
                                 update=":formAltSenha" oncomplete="PF('editarPerfilSenhaDialog').show()"/>

                <p:commandButton value="Apagar conta" styleClass="edit-profile-btn"
                                 update=":formDel" oncomplete="PF('deletarPerfilDialog').show()"/>
            </h:form>
        </div>

        <p:dialog id="criarMetasDialog" widgetVar="criarMetasDialog" header="Crie a sua meta:"
                  modal="true" resizable="false">
            <h:form id="formMetas">
                <div class="profile-grid">
                </div>
                <b:commandButton value="Criar" action="#{metaController.inserir()}"
                                 oncomplete="PF('criarMetasDialog').hide()"/>
            </h:form>
        </p:dialog>

        <p:dialog id="editarPerfilDialog" widgetVar="editarPerfilDialog" header="#{loginController.usuarioLogado.nome}, altere os dados do seu perfil:"
                  modal="true" resizable="false">
            <h:form id="formAlt">
                <div class="profile-grid">
                    <h:outputLabel for="editCpf" value="CPF:"/>
                    <b:inputText id="editCpf" value="#{loginController.usuarioLogado.cpf}"/>
                    <h:outputLabel for="editNome" value="Nome:"/>
                    <b:inputText id="editNome" value="#{loginController.usuarioLogado.nome}"/>

                    <h:outputLabel for="editSobrenome" value="Sobrenome:"/>
                    <b:inputText id="editSobrenome" value="#{loginController.usuarioLogado.sobrenome}"/>

                    <h:outputLabel for="editTelefone" value="Telefone:"/>
                    <b:inputText id="editTelefone" value="#{loginController.usuarioLogado.telefone}"/>

                    <h:outputLabel for="editEmail" value="E-mail:"/>
                    <b:inputText id="editEmail" value="#{loginController.usuarioLogado.email}"/>

                </div>
                <b:commandButton value="Salvar" action="#{loginController.alterarPerfil()}"
                                 oncomplete="PF('editarPerfilDialog').hide()"/>
            </h:form>
        </p:dialog>

        <p:dialog id="editarPerfilSenhaDialog" widgetVar="editarPerfilSenhaDialog" header="#{loginController.usuarioLogado.nome}, altere a senha da sua conta:"
                  modal="true" resizable="false">
            <h:form id="formAltSenha">
                <div class="profile-grid">
                    <h:outputLabel for="ediSenha" value="Senha atual:"/>
                    <b:inputSecret id="senha" value="#{senhaAtual}"/>

                    <h:outputLabel for="editSenhaNova" value="Senha nova:"/>
                    <b:inputSecret id="senhaNova" value="#{senhaNova}"/>

                    <h:outputLabel for="editConfirma" value="Confirmação da senha:"/>
                    <b:inputSecret id="confirma" value="#{confirma}"/>
                </div>
                <b:commandButton value="Confirmar" action="#{loginController.alterarSenha(senhaAtual, senhaNova, confirma)}"
                                 oncomplete="PF('editarPerfilSenhaDialog').hide()"/>
            </h:form>
        </p:dialog>

        <p:dialog id="deletarPerfilDialog" widgetVar="deletarPerfilDialog" header="#{loginController.usuarioLogado.nome}, tem certeza que deseja apagar a sua conta?"
                  modal="true" resizable="false">
            <h:form id="formDel">
                <b:commandButton value="Sim" action="#{loginController.deletar()}"
                                 oncomplete="PF('deletarPerfilDialog').hide()"/>

            </h:form>
        </p:dialog>

    </h:body>
</html>
